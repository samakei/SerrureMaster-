import{a as e,P as s,j as t}from"./index-Bv5CuhOg.js";import{r as l}from"./react-vendor-C11u62No.js";import{g as a,a3 as r,v as n,G as i,s as o,f as c,a as d,d as x,F as m}from"./icons-D4y1Z8Z8.js";import"./supabase-DUEh_P_2.js";const h=({user:h,productId:u,onBack:b})=>{const{courses:f}=e(),[p,j]=l.useState(null),[g,N]=l.useState(null),[v,w]=l.useState({}),[y,k]=l.useState(!1),[S,C]=l.useState(!1);l.useEffect(()=>{const e=f[u];if(e){const s="admin"===h.role,t=e.modules.map(e=>({...e,lessons:e.lessons.filter(e=>s||"published"===e.status)})).filter(e=>e.lessons.length>0||s),l={...e,modules:t};if(j(l),l.modules.length>0){const e=l.modules[0];w({[e.id]:!0}),e.lessons.length>0&&N(e.lessons[0])}}},[u,f,h.role]);const z=s.find(e=>e.id===u);return p&&g?t.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col md:flex-row",children:[t.jsxs("div",{className:"w-full md:w-80 bg-slate-900 border-r border-slate-800 flex flex-col h-[50vh] md:h-screen sticky top-0 z-20",children:[t.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center bg-slate-900",children:[t.jsx("button",{onClick:b,className:"mr-3 text-slate-400 hover:text-white transition","aria-label":"Retour à la liste des formations",children:t.jsx(r,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xs font-bold text-orange-500 uppercase tracking-wider",children:"Formation"}),t.jsx("p",{className:"text-sm font-bold text-white truncate w-48",children:null==z?void 0:z.title})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2 custom-scrollbar",children:p.modules.map((e,s)=>t.jsxs("div",{className:"bg-slate-950/50 rounded-lg overflow-hidden border border-slate-800/50",children:[t.jsxs("button",{onClick:()=>{return s=e.id,void w(e=>({...e,[s]:!e[s]}));var s},className:"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-800 transition text-left",children:[t.jsxs("span",{className:"text-sm font-bold text-slate-200 flex-1",children:[t.jsxs("span",{className:"text-slate-500 mr-2 text-xs",children:["0",s+1,"."]}),e.title]}),v[e.id]?t.jsx(n,{className:"w-4 h-4 text-slate-500"}):t.jsx(i,{className:"w-4 h-4 text-slate-500"})]}),v[e.id]&&t.jsx("div",{className:"border-t border-slate-800/50",children:e.lessons.map(e=>{const s=g.id===e.id;return t.jsxs("button",{onClick:()=>(e=>{N(e),k(!1),C(!1)})(e),className:"w-full px-4 py-3 flex items-start text-left text-sm transition border-l-2 "+(s?"bg-orange-500/10 border-orange-500 text-orange-100":"border-transparent text-slate-400 hover:bg-slate-800/50 hover:text-slate-200"),children:[t.jsx("div",{className:"mt-0.5 mr-3",children:s?t.jsx(o,{className:"w-4 h-4 text-orange-500"}):t.jsx("div",{className:"w-4 h-4 rounded-full border border-slate-600"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"font-medium "+(s?"text-white":""),children:e.title}),"draft"===e.status&&t.jsx("span",{className:"text-[9px] px-1 bg-orange-500/20 text-orange-500 border border-orange-500/30 rounded uppercase",children:"Draft"})]}),t.jsx("p",{className:"text-[10px] opacity-60 mt-0.5",children:e.duration})]})]},e.id)})})]},e.id))}),t.jsx("div",{className:"p-4 border-t border-slate-800 bg-slate-900",children:t.jsxs("a",{href:"https://wa.me/33757570389",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-full py-3 bg-green-600 hover:bg-green-500 text-white rounded-lg font-bold text-sm transition shadow-lg shadow-green-900/20",children:[t.jsx(c,{className:"w-4 h-4 mr-2"}),"SOS WhatsApp (24/7)"]})})]}),t.jsxs("div",{className:"flex-1 flex flex-col h-[50vh] md:h-screen overflow-y-auto bg-slate-950",children:[t.jsx("div",{className:"w-full bg-black relative aspect-video flex items-center justify-center",children:y?t.jsxs("div",{className:"relative w-full h-full",children:[t.jsx("video",{src:g.videoUrl,controls:!0,className:"w-full h-full",poster:g.thumbnail||(null==z?void 0:z.image),onError:()=>C(!0),onContextMenu:e=>e.preventDefault(),controlsList:"nodownload"}),t.jsx("div",{className:"absolute top-4 right-4 opacity-30 pointer-events-none select-none",children:t.jsx("p",{className:"text-[10px] text-white font-mono",children:h.id})}),S&&t.jsx("div",{className:"absolute inset-0 bg-slate-900 flex items-center justify-center text-white",children:t.jsxs("div",{className:"text-center",children:[t.jsx(a,{className:"w-10 h-10 text-red-500 mx-auto mb-2"}),t.jsx("p",{children:"Erreur de chargement vidéo."}),t.jsx("p",{className:"text-sm text-slate-400",children:"Vérifiez votre connexion."})]})})]}):t.jsxs("div",{className:"absolute inset-0 z-10 bg-slate-900/90 backdrop-blur-sm flex flex-col items-center justify-center p-6 text-center",children:[t.jsx(d,{className:"w-16 h-16 text-orange-500 mb-4"}),t.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Avertissement de Sécurité"}),t.jsxs("p",{className:"text-slate-300 max-w-lg mb-6 leading-relaxed",children:["Vous allez visionner une technique professionnelle. ",t.jsx("br",{}),"En cliquant sur \"J'accepte\", vous certifiez être l'occupant légitime du logement et comprenez que SerrureMaster décline toute responsabilité en cas de mauvaise manipulation."]}),t.jsxs("button",{onClick:()=>k(!0),className:"px-8 py-3 bg-white text-slate-900 font-bold rounded-lg hover:bg-slate-200 transition flex items-center",children:[t.jsx(x,{className:"w-4 h-4 mr-2"}),"J'accepte et je visionne"]}),t.jsxs("p",{className:"mt-4 text-[10px] text-slate-500",children:["ID Utilisateur: ",h.id," • IP Loggée"]})]})}),t.jsxs("div",{className:"p-6 md:p-10 max-w-4xl mx-auto w-full",children:[t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:g.title}),t.jsx("p",{className:"text-slate-400 text-sm leading-relaxed max-w-2xl",children:g.description})]}),t.jsxs("div",{className:"bg-slate-900 px-4 py-2 rounded border border-slate-800 text-xs font-mono text-slate-500",children:["Durée: ",g.duration]})]}),g.checklist&&g.checklist.length>0&&t.jsxs("div",{className:"bg-orange-950/20 border border-orange-500/20 rounded-xl p-6 mb-8",children:[t.jsxs("h3",{className:"text-orange-400 font-bold text-sm uppercase tracking-wider mb-4 flex items-center",children:[t.jsx(m,{className:"w-4 h-4 mr-2"}),"Points Clés à retenir"]}),t.jsx("div",{className:"grid gap-3",children:g.checklist.map((e,s)=>t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"bg-orange-500/20 rounded-full p-1 mr-3 mt-0.5",children:t.jsx(x,{className:"w-3 h-3 text-orange-500"})}),t.jsx("span",{className:"text-slate-300 text-sm",children:e})]},s))})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("button",{className:"flex-1 bg-slate-800 hover:bg-slate-700 text-white py-4 rounded-xl font-bold transition flex items-center justify-center border border-slate-700",children:[t.jsx(m,{className:"w-4 h-4 mr-2 text-slate-400"}),"Télécharger le PDF Résumé"]}),t.jsxs("button",{className:"flex-1 bg-indigo-600 hover:bg-indigo-500 text-white py-4 rounded-xl font-bold transition flex items-center justify-center shadow-lg shadow-indigo-900/20",children:["Leçon suivante",t.jsx(i,{className:"w-4 h-4 ml-2"})]})]})]})]})]}):t.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center text-white",children:t.jsxs("div",{className:"text-center",children:[t.jsx(a,{className:"w-12 h-12 text-orange-500 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-bold",children:"Contenu non disponible"}),t.jsx("p",{className:"text-slate-400 mt-2",children:"Le contenu pédagogique pour ce produit est en cours de mise en ligne ou ne contient aucune leçon publiée."}),t.jsx("button",{onClick:b,className:"mt-6 px-4 py-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition",children:"Retour au dashboard"})]})})};export{h as CoursePlayer};
