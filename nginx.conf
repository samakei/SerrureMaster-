events {}

http {
	include       /etc/nginx/mime.types;
	default_type  application/octet-stream;

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	keepalive_timeout  65;
	etag on;
	gzip on;
	gzip_types text/plain text/css application/javascript application/json image/svg+xml;

	server {
		# Cloud Run default port is 8080
		listen 8080;
		server_name _;

		root /usr/share/nginx/html;
		index index.html;

		# Cache static assets aggressively (immutable filenames)
		location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico|webp|woff|woff2)$ {
			expires 7d;
			add_header Cache-Control "public, max-age=604800, immutable";
			try_files $uri =404;
		}

		# SPA fallback to index.html
		location / {
			try_files $uri $uri/ /index.html;
		}

		# Healthcheck endpoint for Cloud Run
		location = /_health {
			return 200 'ok';
			add_header Content-Type text/plain;
		}
	}
}

